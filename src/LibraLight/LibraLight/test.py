import time
import config
from optimized import deeppoly_gpu as dpG
from optimized import symbolic_gpu as symG
from optimized import neurify_gpu as neuG
from optimized import product_gpu as prodG
from main import set_sensitive

def toy():
    config.inputs = ['x01', 'x02']
    config.activations = ['x11', 'x12', 'x21', 'x22']
    config.layers = [
        {
            'x11': {'x01': -0.31, 'x02': 0.99, '_': -0.63},
            'x12': {'x01': -1.25, 'x02': -0.64, '_': 1.88}
        },
        {
            'x21': {'x11': 0.4, 'x12': 1.21, '_': 0.00},
            'x22': {'x11': 0.64, 'x12': 0.69, '_': -0.39}
        },
        {
            'x31': {'x21': 0.26, 'x22': 0.33, '_': 0.45},
            'x32': {'x21': 1.42, 'x22': 0.40, '_': -0.45}
        }
    ]
    config.outputs = ('x31', 'x32')

    config.bounds = {'x01': (0, 1), 'x02': (0, 1)}
    config.continuous = ['x01', 'x02']

    set_sensitive(2)

    config.min_difference = 0.25
    config.start_difference = 2
    config.start_unstable = 2
    config.max_unstable = 2

    ranges = dict()
    ranges[config.sensitive] = (config.values[0][0], config.values[1][1])
    ranges['x01'] = (0, 1)
    # 2. call init with the ranges dictionary
    from abstract_domain import init
    initial = init(ranges)
    print(f"{ranges}")
    #symG.analyze(initial1, config.inputs, config.layers, config.outputs)
    #prodG.analyze(initial1, config.inputs, config.layers, config.outputs, domains={"Symbolic"})
    L= 1
    time_sec = time.time()
    prodG.analyze(L, initial, config.sensitive, config.inputs, config.layers,config.activations, config.outputs, domains={"DeepPoly","Neurify","Symbolic"})
    time_sec = time.time() - time_sec
    print(f"GPU time: {time_sec}\n\n")
    #for i in range(len(activated)):
    #    print(f"GPU -> active:{activated[i]}; deactive:{deactivated[i]}; outcome:{outcome[i]}")


def toy2():
    config.inputs = ['x00','x01', 'x02','x03','x04', 'x05','x06','x07','x08', 'x09','x010','x011']
    config.activations = ['x10','x11', 'x12', 'x13', 'x14','x15','x16', 'x17', 'x18', 'x19', 'x110', 'x111',
                          'x20','x21', 'x22', 'x23', 'x24','x25','x26', 'x27', 'x28', 'x29', 'x210', 'x211',
                          'x30', 'x31', 'x32', 'x33', 'x34', 'x35', 'x36', 'x37', 'x38', 'x39', 'x310', 'x311',
                          'x40', 'x41', 'x42', 'x43', 'x44', 'x45', 'x46', 'x47', 'x48', 'x49', 'x410', 'x411',]
    config.layers = [
        {
            'x10':  {'x00': 0.042868,  'x01': 0.358656, 'x02': -0.042266, 'x03': 0.044351, 'x04': 1.089207, 'x05': -0.094103,'x06': 0.030209, 'x07': 0.030209,  'x08': 0.030209,  'x09': 0.030209,  'x010': 0.030209,  'x011': 0.030209,  '_': 0.813460},
            'x11':  {'x00': -0.000181, 'x01': 0.023415, 'x02': -0.173008, 'x03': -0.189846,'x04': 2.324846, 'x05': -0.481679,'x06': -0.018099,'x07': -0.018099, 'x08': -0.018099, 'x09': -0.018099, 'x010': -0.018099, 'x011': -0.018099, '_': 0.721989},
            'x12':  {'x00': -0.002704, 'x01': 0.305991, 'x02': 0.257663,  'x03': 0.382174, 'x04': 1.207401, 'x05': 0.269870, 'x06': -0.237693,'x07': -0.237693, 'x08': -0.237693, 'x09': -0.237693, 'x010': -0.237693, 'x011': -0.237693, '_': -0.089845},
            'x13':  {'x00': 0.022004,  'x01': 0.842049, 'x02': 0.222931,  'x03': 0.421870, 'x04': 1.709608, 'x05': 0.152055, 'x06': -0.137482,'x07': -0.137482, 'x08': -0.137482, 'x09': -0.137482, 'x010': -0.137482, 'x011': -0.137482, '_': -0.703942},
            'x14':  {'x00': -0.001252, 'x01': 0.187511, 'x02': 0.080904,  'x03': 0.145405, 'x04': 1.796169, 'x05': 0.187181, 'x06': -0.063689,'x07': -0.063689, 'x08': -0.063689, 'x09': -0.063689, 'x010': -0.063689, 'x011': -0.063689, '_': 0.745336},
            'x15':  {'x00': 0.009304,  'x01': 1.219303, 'x02': 0.346605,  'x03': 0.449413, 'x04': 2.422393, 'x05': 0.569870, 'x06': -0.152754,'x07': -0.152754, 'x08': -0.152754, 'x09': -0.152754, 'x010': -0.152754, 'x011': -0.152754, '_': 0.448015},
            'x16':  {'x00': 0.015865,  'x01': 0.236149, 'x02': 0.139553,  'x03': 0.179294, 'x04': 0.451206, 'x05': 0.569870, 'x06': -0.044815,'x07': -0.044815, 'x08': -0.044815, 'x09': -0.044815, 'x010': -0.044815, 'x011': -0.044815, '_': 1.071367},
            'x17':  {'x00': 0.021715,  'x01': 0.702090, 'x02': 0.428681,  'x03': 0.577222, 'x04': -2.244044,'x05': 0.437589, 'x06': 0.081774, 'x07': 0.081774,  'x08': 0.081774,  'x09': 0.081774,  'x010': 0.081774,  'x011': 0.081774,  '_': 1.625044},
            'x18':  {'x00': 0.010054,  'x01': 3.692974, 'x02': 0.091981,  'x03': 0.237195, 'x04': -0.383203,'x05': 0.202910, 'x06': -0.048303,'x07': -0.048303, 'x08': -0.048303, 'x09': -0.048303, 'x010': -0.048303, 'x011': -0.048303, '_': 1.026329},
            'x19':  {'x00': -0.010964, 'x01': 0.621551, 'x02': 0.235219,  'x03': 0.417779, 'x04': 1.653007, 'x05': 0.215808, 'x06': -0.143462,'x07': -0.143462, 'x08': -0.143462, 'x09': -0.143462, 'x010': -0.143462, 'x011': -0.143462, '_': 0.767937},
            'x110': {'x00': -0.026458, 'x01': 0.930249, 'x02': 0.385343,  'x03': 0.294321, 'x04': 0.507272, 'x05': 0.281220, 'x06': -0.019293,'x07': -0.019293, 'x08': -0.019293, 'x09': -0.019293, 'x010': -0.019293, 'x011': -0.019293, '_': 1.359362},
            'x111': {'x00': 0.003056,  'x01': 0.141511, 'x02': 0.034918,  'x03': 0.024875, 'x04': 2.049487, 'x05': -0.015903,'x06': 0.008293, 'x07': 0.008293,  'x08': 0.008293,  'x09': 0.008293,  'x010': 0.008293,  'x011': 0.008293,  '_': 1.435690},

        },
        {
            'x20':  {'x10': 0.042868,  'x11': 0.358656, 'x12': -0.042266, 'x13': 0.044351, 'x14': 1.089207, 'x15': -0.094103,'x16': 0.030209, 'x17': 0.030209,  'x18': 0.030209,  'x19': 0.030209,  'x110': 0.030209,  'x111': 0.030209,  '_': 0.813460},
            'x21':  {'x10': -0.000181, 'x11': 0.023415, 'x12': -0.173008, 'x13': -0.189846,'x14': 2.324846, 'x15': -0.481679,'x16': -0.018099,'x17': -0.018099, 'x18': -0.018099, 'x19': -0.018099, 'x110': -0.018099, 'x111': -0.018099, '_': 0.721989},
            'x22':  {'x10': -0.002704, 'x11': 0.305991, 'x12': 0.257663,  'x13': 0.382174, 'x14': 1.207401, 'x15': 0.269870, 'x16': -0.237693,'x17': -0.237693, 'x18': -0.237693, 'x19': -0.237693, 'x110': -0.237693, 'x111': -0.237693, '_': -0.089845},
            'x23':  {'x10': 0.022004,  'x11': 0.842049, 'x12': 0.222931,  'x13': 0.421870, 'x14': 1.709608, 'x15': 0.152055, 'x16': -0.137482,'x17': -0.137482, 'x18': -0.137482, 'x19': -0.137482, 'x110': -0.137482, 'x111': -0.137482, '_': -0.703942},
            'x24':  {'x10': -0.001252, 'x11': 0.187511, 'x12': 0.080904,  'x13': 0.145405, 'x14': 1.796169, 'x15': 0.187181, 'x16': -0.063689,'x17': -0.063689, 'x18': -0.063689, 'x19': -0.063689, 'x110': -0.063689, 'x111': -0.063689, '_': 0.745336},
            'x25':  {'x10': 0.009304,  'x11': 1.219303, 'x12': 0.346605,  'x13': 0.449413, 'x14': 2.422393, 'x15': 0.569870, 'x16': -0.152754,'x17': -0.152754, 'x18': -0.152754, 'x19': -0.152754, 'x110': -0.152754, 'x111': -0.152754, '_': 0.448015},
            'x26':  {'x10': 0.015865,  'x11': 0.236149, 'x12': 0.139553,  'x13': 0.179294, 'x14': 0.451206, 'x15': 0.569870, 'x16': -0.044815,'x17': -0.044815, 'x18': -0.044815, 'x19': -0.044815, 'x110': -0.044815, 'x111': -0.044815, '_': 1.071367},
            'x27':  {'x10': 0.021715,  'x11': 0.702090, 'x12': 0.428681,  'x13': 0.577222, 'x14': -2.244044,'x15': 0.437589, 'x16': 0.081774, 'x17': 0.081774,  'x18': 0.081774,  'x19': 0.081774,  'x110': 0.081774,  'x111': 0.081774,  '_': 1.625044},
            'x28':  {'x10': 0.010054,  'x11': 3.692974, 'x12': 0.091981,  'x13': 0.237195, 'x14': -0.383203,'x15': 0.202910, 'x16': -0.048303,'x17': -0.048303, 'x18': -0.048303, 'x19': -0.048303, 'x110': -0.048303, 'x111': -0.048303, '_': 1.026329},
            'x29':  {'x10': -0.010964, 'x11': 0.621551, 'x12': 0.235219,  'x13': 0.417779, 'x14': 1.653007, 'x15': 0.215808, 'x16': -0.143462,'x17': -0.143462, 'x18': -0.143462, 'x19': -0.143462, 'x110': -0.143462, 'x111': -0.143462, '_': 0.767937},
            'x210': {'x10': -0.026458, 'x11': 0.930249, 'x12': 0.385343,  'x13': 0.294321, 'x14': 0.507272, 'x15': 0.281220, 'x16': -0.019293,'x17': -0.019293, 'x18': -0.019293, 'x19': -0.019293, 'x110': -0.019293, 'x111': -0.019293, '_': 1.359362},
            'x211': {'x10': 0.003056,  'x11': 0.141511, 'x12': 0.034918,  'x13': 0.024875, 'x14': 2.049487, 'x15': -0.015903,'x16': 0.008293, 'x17': 0.008293,  'x18': 0.008293,  'x19': 0.008293,  'x110': 0.008293,  'x111': 0.008293,  '_': 1.435690},

        },
        {
            'x30':  {'x20': 0.042868,  'x21': 0.358656, 'x22': -0.042266, 'x23': 0.044351, 'x24': 1.089207, 'x25': -0.094103,'x26': 0.030209, 'x27': 0.030209,  'x28': 0.030209,  'x29': 0.030209,  'x210': 0.030209,  'x211': 0.030209,  '_': 0.813460},
            'x31':  {'x20': -0.000181, 'x21': 0.023415, 'x22': -0.173008, 'x23': -0.189846,'x24': 2.324846, 'x25': -0.481679,'x26': -0.018099,'x27': -0.018099, 'x28': -0.018099, 'x29': -0.018099, 'x210': -0.018099, 'x211': -0.018099, '_': 0.721989},
            'x32':  {'x20': -0.002704, 'x21': 0.305991, 'x22': 0.257663,  'x23': 0.382174, 'x24': 1.207401, 'x25': 0.269870, 'x26': -0.237693,'x27': -0.237693, 'x28': -0.237693, 'x29': -0.237693, 'x210': -0.237693, 'x211': -0.237693, '_': -0.089845},
            'x33':  {'x20': 0.022004,  'x21': 0.842049, 'x22': 0.222931,  'x23': 0.421870, 'x24': 1.709608, 'x25': 0.152055, 'x26': -0.137482,'x27': -0.137482, 'x28': -0.137482, 'x29': -0.137482, 'x210': -0.137482, 'x211': -0.137482, '_': -0.703942},
            'x34':  {'x20': -0.001252, 'x21': 0.187511, 'x22': 0.080904,  'x23': 0.145405, 'x24': 1.796169, 'x25': 0.187181, 'x26': -0.063689,'x27': -0.063689, 'x28': -0.063689, 'x29': -0.063689, 'x210': -0.063689, 'x211': -0.063689, '_': 0.745336},
            'x35':  {'x20': 0.009304,  'x21': 1.219303, 'x22': 0.346605,  'x23': 0.449413, 'x24': 2.422393, 'x25': 0.569870, 'x26': -0.152754,'x27': -0.152754, 'x28': -0.152754, 'x29': -0.152754, 'x210': -0.152754, 'x211': -0.152754, '_': 0.448015},
            'x36':  {'x20': 0.015865,  'x21': 0.236149, 'x22': 0.139553,  'x23': 0.179294, 'x24': 0.451206, 'x25': 0.569870, 'x26': -0.044815,'x27': -0.044815, 'x28': -0.044815, 'x29': -0.044815, 'x210': -0.044815, 'x211': -0.044815, '_': 1.071367},
            'x37':  {'x20': 0.021715,  'x21': 0.702090, 'x22': 0.428681,  'x23': 0.577222, 'x24': -2.244044,'x25': 0.437589, 'x26': 0.081774, 'x27': 0.081774,  'x28': 0.081774,  'x29': 0.081774,  'x210': 0.081774,  'x211': 0.081774,  '_': 1.625044},
            'x38':  {'x20': 0.010054,  'x21': 3.692974, 'x22': 0.091981,  'x23': 0.237195, 'x24': -0.383203,'x25': 0.202910, 'x26': -0.048303,'x27': -0.048303, 'x28': -0.048303, 'x29': -0.048303, 'x210': -0.048303, 'x211': -0.048303, '_': 1.026329},
            'x39':  {'x20': -0.010964, 'x21': 0.621551, 'x22': 0.235219,  'x23': 0.417779, 'x24': 1.653007, 'x25': 0.215808, 'x26': -0.143462,'x27': -0.143462, 'x28': -0.143462, 'x29': -0.143462, 'x210': -0.143462, 'x211': -0.143462, '_': 0.767937},
            'x310': {'x20': -0.026458, 'x21': 0.930249, 'x22': 0.385343,  'x23': 0.294321, 'x24': 0.507272, 'x25': 0.281220, 'x26': -0.019293,'x27': -0.019293, 'x28': -0.019293, 'x29': -0.019293, 'x210': -0.019293, 'x211': -0.019293, '_': 1.359362},
            'x311': {'x20': 0.003056,  'x21': 0.141511, 'x22': 0.034918,  'x23': 0.024875, 'x24': 2.049487, 'x25': -0.015903,'x26': 0.008293, 'x27': 0.008293,  'x28': 0.008293,  'x29': 0.008293,  'x210': 0.008293,  'x211': 0.008293,  '_': 1.435690},
        },
        {
            'x40': {'x30': 0.042868,  'x31': 0.358656, 'x32': -0.042266,'x33': 0.044351, 'x34': 1.089207, 'x35': -0.094103,'x36': 0.030209,  'x37': 0.030209,  'x38': 0.030209,  'x39': 0.030209, 'x310': 0.030209,  'x311': 0.030209,  '_': 0.813460},
            'x41': {'x30': -0.000181, 'x31': 0.023415, 'x32': -0.173008,'x33': -0.189846,'x34': 2.324846, 'x35': -0.481679,'x36': -0.018099, 'x37': -0.018099, 'x38': -0.018099, 'x39': -0.018099,'x310': -0.018099, 'x311': -0.018099, '_': 0.721989},
            'x42': {'x30': -0.002704, 'x31': 0.305991, 'x32': 0.257663, 'x33': 0.382174, 'x34': 1.207401, 'x35': 0.269870, 'x36': -0.237693, 'x37': -0.237693, 'x38': -0.237693, 'x39': -0.237693,'x310': -0.237693, 'x311': -0.237693, '_': -0.089845},
            'x43': {'x30': 0.022004,  'x31': 0.842049, 'x32': 0.222931, 'x33': 0.421870, 'x34': 1.709608, 'x35': 0.152055, 'x36': -0.137482, 'x37': -0.137482, 'x38': -0.137482, 'x39': -0.137482,'x310': -0.137482, 'x311': -0.137482, '_': -0.703942},
            'x44': {'x30': -0.001252, 'x31': 0.187511, 'x32': 0.080904, 'x33': 0.145405, 'x34': 1.796169, 'x35': 0.187181, 'x36': -0.063689, 'x37': -0.063689, 'x38': -0.063689, 'x39': -0.063689,'x310': -0.063689, 'x311': -0.063689, '_': 0.745336},
            'x45': {'x30': 0.009304,  'x31': 1.219303, 'x32': 0.346605, 'x33': 0.449413, 'x34': 2.422393, 'x35': 0.569870, 'x36': -0.152754, 'x37': -0.152754, 'x38': -0.152754, 'x39': -0.152754,'x310': -0.152754, 'x311': -0.152754, '_': 0.448015},
            'x46': {'x30': 0.015865,  'x31': 0.236149, 'x32': 0.139553, 'x33': 0.179294, 'x34': 0.451206, 'x35': 0.569870, 'x36': -0.044815, 'x37': -0.044815, 'x38': -0.044815, 'x39': -0.044815,'x310': -0.044815, 'x311': -0.044815, '_': 1.071367},
            'x47': {'x30': 0.021715,  'x31': 0.702090, 'x32': 0.428681, 'x33': 0.577222, 'x34': -2.244044,'x35': 0.437589, 'x36': 0.081774,  'x37': 0.081774,  'x38': 0.081774,  'x39': 0.081774, 'x310': 0.081774,  'x311': 0.081774,  '_': 1.625044},
            'x48': {'x30': 0.010054,  'x31': 3.692974, 'x32': 0.091981, 'x33': 0.237195, 'x34': -0.383203,'x35': 0.202910, 'x36': -0.048303, 'x37': -0.048303, 'x38': -0.048303, 'x39': -0.048303,'x310': -0.048303, 'x311': -0.048303, '_': 1.026329},
            'x49': {'x30': -0.010964, 'x31': 0.621551, 'x32': 0.235219, 'x33': 0.417779, 'x34': 1.653007, 'x35': 0.215808, 'x36': -0.143462, 'x37': -0.143462, 'x38': -0.143462, 'x39': -0.143462,'x310': -0.143462, 'x311': -0.143462, '_': 0.767937},
            'x410':{'x30': -0.026458, 'x31': 0.930249, 'x32': 0.385343, 'x33': 0.294321, 'x34': 0.507272, 'x35': 0.281220, 'x36': -0.019293, 'x37': -0.019293, 'x38': -0.019293, 'x39': -0.019293,'x310': -0.019293, 'x311': -0.019293, '_': 1.359362},
            'x411':{'x30': 0.003056,  'x31': 0.141511, 'x32': 0.034918, 'x33': 0.024875, 'x34': 2.049487, 'x35': -0.015903,'x36': 0.008293,  'x37': 0.008293,  'x38': 0.008293,  'x39': 0.008293, 'x310': 0.008293,  'x311': 0.008293,  '_': 1.435690},
        },
        {
            'x50': {'x40': 0.042868,  'x41': 0.358656, 'x42': -0.042266,'x43': 0.044351, 'x44': 1.089207, 'x45': -0.094103,'x46': 0.030209,  'x47': 0.030209,  'x48': 0.030209,  'x49': 0.030209, 'x410': 0.030209,  'x411': 0.030209,  '_': 0.813460},
            'x51': {'x40': -0.000181, 'x41': 0.023415, 'x42': -0.173008,'x43': -0.189846,'x44': 2.324846, 'x45': -0.481679,'x46': -0.018099, 'x47': -0.018099, 'x48': -0.018099, 'x49': -0.018099,'x410': -0.018099, 'x411': -0.018099, '_': 0.721989},
        }
    ]
    config.outputs = ('x50', 'x51')

    config.bounds = {'x00': (-1, 1),'x01': (-1, 1), 'x02': (-1, 1),'x03': (-1, 1), 'x04': (-1, 1),'x05': (-1, 1), 'x06': (-1, 1),'x07': (1, 1), 'x08': (-1, -1),'x09': (-1, -1), 'x010': (-1, -1),'x011': (1, 1)}
    config.continuous = ['x00','x01', 'x02','x03','x04', 'x05','x06','x07','x08', 'x09','x010','x011']

    set_sensitive(2)

    config.min_difference = 0.25
    config.start_difference = 2
    config.start_unstable = 2
    config.max_unstable = 2

    ranges = {'x00': (-1, 1),'x01': (-1, 1), 'x02': (-1, 1),'x03': (-1, 1), 'x04': (-1, 1),'x05': (-1, 1), 'x06': (-1, 1),'x07': (1, 1), 'x08': (-1, -1),'x09': (-1, -1), 'x010': (-1, -1),'x011': (1, 1)}
    ranges[config.sensitive] = (config.values[0][0], config.values[1][1])

    # 2. call init with the ranges dictionary
    from abstract_domain import init
    initial = init(ranges)
    print(f"{ranges}")
    L= 0.25
    time_sec = time.time()
    activatedL, deactivatedL, outcomeL = prodG.analyze(L, initial, config.sensitive, config.inputs, config.layers,config.activations, config.outputs, domains={"DeepPoly","Neurify","Symbolic"})
    #dpG.analyze(L,initial,config.sensitive, config.inputs, config.layers,config.activations, config.outputs)
    time_sec = time.time() - time_sec
    print(f"GPU time: {time_sec}\n\n")
    for i in range(len(activatedL)):
        for j in range(len(activatedL[0])):
            #print(f"GPU [{i},{j}] -> active:{activatedL[i][j]}; deactive:{deactivatedL[i][j]}; outcome:{outcomeL[i][j]}")
            pass